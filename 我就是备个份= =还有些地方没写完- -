<?php

  session_start();


  if(!isset($_SESSION['username'])||!isset($_SESSION['type'])){


    exit('illegal access!');
  }
  else
  	if($_SESSION['type']=="student")
  		exit('illegal access!');
 
if (isset($_FILES['upfile'])) 	
if(is_uploaded_file($_FILES['upfile']['tmp_name'])){
$upfile=$_FILES["upfile"]; 
//获取数组里面的值 
$name=$upfile["name"];//上传文件的文件名 
$type=$upfile["type"];//上传文件的类型 
$size=$upfile["size"];//上传文件的大小 
$tmp_name=$upfile["tmp_name"];//上传文件的临时存放路径 

echo "上传文件名称是：".$name."<br/>"; 
echo "上传文件类型是：".$type."<br/>"; 
echo "上传文件大小是：".$size."<br/>"; 
echo "上传文件的临时存放路径是：".$tmp_name."<br/>"; 

echo "开始移动上传文件<br/>"; 
//把上传的临时文件移动到up目录下面 
move_uploaded_file($tmp_name,'C:/xampp/htdocs/competition/img/'.$name); 
$destination='img/'.$name; 
$_SESSION['destination'] = $destination;
echo "文件上传成功！"; 
}


	$db=mysql_connect("localhost","root");
	mysql_select_db("scs",$db);
	if(isset($_POST['View'])){//查看已出题目
		$result=mysql_query("SELECT*FROM competition");
		while($myrow=mysql_fetch_array($result)){
		printf("题目：%s\n<br>",$myrow["competition"]);
		printf("选项一：%s\n<br>",$myrow["option1"]);
		printf("选项二：%s\n<br>",$myrow["option2"]);
		printf("选项三：%s\n<br>",$myrow["option3"]);
		printf("选项四：%s\n<br>",$myrow["option4"]);
		printf("答案：%s\n<br>",$myrow["answer"]);
		printf("分值：%s\n<br>",$myrow["score"]);
		}
	}  
	mysql_close($db);
	
	
	$db=mysql_connect("localhost","root");//修改数据
	mysql_select_db("scs",$db);
	if(isset($_POST['Update'])){
		$sql="UPDATE competition SET competition='$competition',option1='$option1',option2='$option2',option3='$option3',option4='option4',
			answer='$answer',score='$score' WHERE id=$id";
		$result=mysql_query($sql);
		echo"修改成功！\n";
	}
	mysql_close($db);
	
	$db=mysql_connect("localhost","root");//删除数据
	mysql_select_db("scs",$db);
	if(isset($_POST['Delete'])){
		mysql_query("DELETE FROM competition WHERE id=$id");
		echo"删除成功！\n";
	}
	mysql_close($db);
	
	
	
	
    if(isset($_POST['Submit'])){//判断用户是否提交登录表单，如果是则执行如下代码
	
		$competition = $_POST['textfield1'];
		$option1 = $_POST['textfield2'];
		$option2 = $_POST['textfield3'];
		$option3  = $_POST['textfield4'];
		$option4  = $_POST['textfield5'];
		$answer  = $_POST['textfield6'];
		$destination = $_SESSION['destination'] ;
		$score   = $_POST['textfield7'];
		
		
		
		
		$db_server= "localhost";  
		$db_user= "root";  
		$db_pwd= "lulu";
		$db_name= "scs";
		$conn=mysql_pconnect($db_server, $db_user, $db_pwd);
	


		$sql = "INSERT INTO `SCS`.`competition` (`competition`, `option1`, `option2`, `option3`, `option4`,`answer`, `img`,`score`) VALUES ('$competition',  '$option1', '$option2', '$option3', '$option4', '$answer','$destination','$score');";
            //用用户名和密码进行查询
           

            $result = mysql_query($sql,$conn);
		if ($result){
			echo "<script>alert('添加成功');</script>";
			
				}
		$_SESSION['destination']="";

}

		mysql_select_db("scs", $con);//建立存学生答案的表
		$sql = "CREATE TABLE answer 
		(
		studentID varchar(15);
		questionID int;
		answer varchar(15);
		)";
		mysql_query($sql,$con);

		mysql_close($con);

		
		mysql_select_db("scs", $con);//建立存分数的表
		$sql = "CREATE TABLE ALLScores 
		(
		score int;
		studentID varchar(15);
		usetime int;
		submittime DATETIME;
		)";
		mysql_query($sql,$con);
 
		mysql_close($con);
		

?>





<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>出题</title>
<style type="text/css">

</style>
<script type="text/JavaScript">
<!--
function MM_preloadImages() { //v3.0
  var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
    var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
    if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
}
//-->
</script>
</head>

<body>

<form action="" enctype="multipart/form-data" method="post" 
name="uploadfile">上传图片：<input type="file" name="upfile" /><br> 

<input type="submit" value="上传" /></form> 



 <div id="add">
    <div id="problem0" style="display: none;" sample="true">
    <p>&nbsp;</p>
    <form id="form1" name="form1" method="post" action="">
      <p class="STYLE1">题目：　　　	
        <label>
            <input type="text" name="textfield1" value="" />
        </label>
      </p>
      <p class="STYLE1">选项一：
        <label>
        <input type="text" name="textfield2"  value=""/>
        </label>
      </p>
      <p class="STYLE1">选项二: 　  
         <label>
        <input type="text" name="textfield3"  value=""/>
        </label>
      </p>
      <p class="STYLE1">选项三：
        <label>
        <input type="text" name="textfield4"  value=""/>
        </label>
      </p>
      <p class="STYLE1">选项四：
        <label>
          <input type="text" name="textfield5"  value=""/>
        </label>
      </p> 
      <p class="STYLE1">答案：（大写字母）         
        <label>
        <input type="text" name="textfield6"  value=""/>
        </label>
      </p>
       <p class="STYLE1">分值：（请填写阿拉伯数字）        
        <label>
        <input type="text" name="textfield7"  value="">
        </label>
      </p>
     

      <p>
        <span class="STYLE1">
        <label>
        　　　　　　　　
        <input name="Submit" type="submit" class="STYLE1" value="保存" />
        </label>
      </span> </p>
	  
	  <p>
        <span class="STYLE1">
        <label>
        　　　　　　　　
        <input name="reset" type="reset" class="STYLE1" value="重置" />
        </label>
      </span> </p>
	  <p>
        <span class="STYLE1">
        <label>
        　　　　　　　　
        <input name="View" type="submit" class="STYLE1" value="查看已出题目"  />
        </label>
      </span> </p>
	  
	  <p>
        <span class="STYLE1">
        <label>
        　　　　　　　　
        <input name="Update" type="submit" class="STYLE1" value="修改已出题目"  />
        </label>
      </span> </p>
	  
	  <p>
        <span class="STYLE1">
        <label>
        　　　　　　　　
        <input name="Delete" type="submit" class="STYLE1" value="删除已出题目"  />
        </label>
      </span> </p>
	  

      <p>&nbsp;</p>
    </form>
  </div>
</div>

</body>
</html>
